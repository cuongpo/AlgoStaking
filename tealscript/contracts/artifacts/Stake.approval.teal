#pragma version 9

// This TEAL was generated by TEALScript v0.59.0
// https://github.com/algorandfoundation/TEALScript

// This contract is compliant with and/or implements the following ARCs: [ ARC4 ]

// The following ten lines of TEAL handle initial program flow
// This pattern is used to make it easy for anyone to parse the start of the program and determine if a specific action is allowed
// Here, action refers to the OnComplete in combination with whether the app is being created or called
// Every possible action for this contract is represented in the switch statement
// If the action is not implmented in the contract, its repsective branch will be "NOT_IMPLMENTED" which just contains "err"
txn ApplicationID
int 0
>
int 6
*
txn OnCompletion
+
switch create_NoOp NOT_IMPLEMENTED NOT_IMPLEMENTED NOT_IMPLEMENTED NOT_IMPLEMENTED NOT_IMPLEMENTED call_NoOp

NOT_IMPLEMENTED:
	err

// bootstrap()uint64
//
// // mint Token
abi_route_bootstrap:
	byte 0x // push empty bytes to fill the stack frame for this subroutine's local variables

	// execute bootstrap()uint64
	callsub bootstrap
	int 1
	return

bootstrap:
	proto 1 0

	// contracts/stake.algo.ts:34
	// verifyTxn(this.txn, { sender: this.app.creator })
	// verify sender
	txn Sender
	txna Applications 0
	app_params_get AppCreator
	assert
	==
	assert

	// contracts/stake.algo.ts:35
	// stakingToken = sendAssetCreation({
	//       configAssetTotal: 100000000,
	//     })
	itxn_begin
	int acfg
	itxn_field TypeEnum

	// contracts/stake.algo.ts:36
	// configAssetTotal: 100000000
	int 100000000
	itxn_field ConfigAssetTotal

	// Fee field not set, defaulting to 0
	int 0
	itxn_field Fee

	// Submit inner transaction
	itxn_submit
	itxn CreatedAssetID
	frame_bury -1 // stakingToken: asset

	// contracts/stake.algo.ts:39
	// this.stakingToken.value = stakingToken
	byte 0x7374616b696e67546f6b656e // "stakingToken"
	frame_dig -1 // stakingToken: asset
	app_global_put

	// contracts/stake.algo.ts:40
	// this.totalSupply.value = 1
	byte 0x746f74616c537570706c79 // "totalSupply"
	int 1
	app_global_put

	// contracts/stake.algo.ts:41
	// this.rewardRate.value = 1
	byte 0x72657761726452617465 // "rewardRate"
	int 1
	app_global_put

	// contracts/stake.algo.ts:42
	// this.finishAt.value= 0
	byte 0x66696e6973684174 // "finishAt"
	int 0
	app_global_put

	// contracts/stake.algo.ts:43
	// this.rewardPerTokenStored.value =0
	byte 0x726577617264506572546f6b656e53746f726564 // "rewardPerTokenStored"
	int 0
	app_global_put

	// contracts/stake.algo.ts:44
	// return stakingToken;
	frame_dig -1 // stakingToken: asset
	itob
	byte 0x151f7c75
	swap
	concat
	log
	retsub

// faucet(asset)void
abi_route_faucet:
	byte 0x // push empty bytes to fill the stack frame for this subroutine's local variables

	// stakingToken: asset
	txna ApplicationArgs 1
	btoi
	txnas Assets

	// execute faucet(asset)void
	callsub faucet
	int 1
	return

faucet:
	proto 2 0

	// contracts/stake.algo.ts:48
	// sendAssetTransfer({
	//       xferAsset: this.stakingToken.value,
	//       assetReceiver: this.txn.sender,
	//       assetAmount: 1,
	//     })
	itxn_begin
	int axfer
	itxn_field TypeEnum

	// contracts/stake.algo.ts:49
	// xferAsset: this.stakingToken.value
	byte 0x7374616b696e67546f6b656e // "stakingToken"
	app_global_get
	itxn_field XferAsset

	// contracts/stake.algo.ts:50
	// assetReceiver: this.txn.sender
	txn Sender
	itxn_field AssetReceiver

	// contracts/stake.algo.ts:51
	// assetAmount: 1
	int 1
	itxn_field AssetAmount

	// Fee field not set, defaulting to 0
	int 0
	itxn_field Fee

	// Submit inner transaction
	itxn_submit

	// contracts/stake.algo.ts:53
	// acc: accData = {
	//       balance: 0,
	//       rewards: 0,
	//       userRewardPerTokenPaid: 0,
	//       earned: 0,
	//     }
	byte 0x0000000000000000000000000000000000000000000000000000000000000000
	frame_bury -2 // acc: accData

	// contracts/stake.algo.ts:59
	// this.accData(this.txn.sender).value = acc
	txn Sender
	byte 0x0000000000000000000000000000000000000000000000000000000000000000 // acc: accData
	box_put
	retsub

// getStakingToken()uint64
abi_route_getStakingToken:
	// execute getStakingToken()uint64
	callsub getStakingToken
	int 1
	return

getStakingToken:
	proto 0 0

	// contracts/stake.algo.ts:64
	// return this.stakingToken.value;
	byte 0x7374616b696e67546f6b656e // "stakingToken"
	app_global_get
	itob
	byte 0x151f7c75
	swap
	concat
	log
	retsub

// createApplication(uint64)address
abi_route_createApplication:
	// duration: uint64
	txna ApplicationArgs 1
	btoi

	// execute createApplication(uint64)address
	callsub createApplication
	int 1
	return

createApplication:
	proto 1 0

	// contracts/stake.algo.ts:68
	// this.duration.value = duration
	byte 0x6475726174696f6e // "duration"
	frame_dig -1 // duration: uint64
	app_global_put

	// contracts/stake.algo.ts:69
	// return this.app.address;
	byte 0x151f7c75
	global CurrentApplicationAddress
	concat
	log
	retsub

// lastTimeRewardApplicable()uint64
abi_route_lastTimeRewardApplicable:
	// execute lastTimeRewardApplicable()uint64
	callsub lastTimeRewardApplicable
	int 1
	return

lastTimeRewardApplicable:
	proto 0 0

	// contracts/stake.algo.ts:73
	// this.lastTimeReward.value = globals.latestTimestamp
	byte 0x6c61737454696d65526577617264 // "lastTimeReward"
	global LatestTimestamp
	app_global_put

	// contracts/stake.algo.ts:74
	// return this.lastTimeReward.value
	byte 0x6c61737454696d65526577617264 // "lastTimeReward"
	app_global_get
	itob
	byte 0x151f7c75
	swap
	concat
	log
	retsub

// rewardPerToken()uint64
abi_route_rewardPerToken:
	// execute rewardPerToken()uint64
	callsub rewardPerToken
	int 1
	return

rewardPerToken:
	proto 0 0

	// contracts/stake.algo.ts:78
	// this.lastTimeRewardApplicable()
	callsub lastTimeRewardApplicable

	// if0_condition
	// contracts/stake.algo.ts:79
	// this.totalSupply.value === 0
	byte 0x746f74616c537570706c79 // "totalSupply"
	app_global_get
	int 0
	==
	bz if0_end

	// if0_consequent
	// contracts/stake.algo.ts:80
	// return this.rewardPerTokenStored.value;
	byte 0x726577617264506572546f6b656e53746f726564 // "rewardPerTokenStored"
	app_global_get
	itob
	byte 0x151f7c75
	swap
	concat
	log
	retsub

if0_end:
	// contracts/stake.algo.ts:82
	// this.rewardPerTokenStored.value = this.rewardPerTokenStored.value + this.rewardRate.value*1000*(this.lastTimeReward.value - this.updatedAt.value)/this.totalSupply.value
	byte 0x726577617264506572546f6b656e53746f726564 // "rewardPerTokenStored"
	byte 0x726577617264506572546f6b656e53746f726564 // "rewardPerTokenStored"
	app_global_get
	byte 0x72657761726452617465 // "rewardRate"
	app_global_get
	int 1000
	*
	byte 0x6c61737454696d65526577617264 // "lastTimeReward"
	app_global_get
	byte 0x757064617465644174 // "updatedAt"
	app_global_get
	-
	*
	byte 0x746f74616c537570706c79 // "totalSupply"
	app_global_get
	/
	+
	app_global_put

	// contracts/stake.algo.ts:83
	// return  this.rewardPerTokenStored.value;
	byte 0x726577617264506572546f6b656e53746f726564 // "rewardPerTokenStored"
	app_global_get
	itob
	byte 0x151f7c75
	swap
	concat
	log
	retsub

// earned(address)uint64
abi_route_earned:
	// account: address
	txna ApplicationArgs 1
	dup
	len
	int 32
	==
	assert

	// execute earned(address)uint64
	callsub earned
	int 1
	return

earned:
	proto 1 0

	// contracts/stake.algo.ts:87
	// this.accData(account).value.earned = (
	//       (this.accData(account).value.balance * (this.rewardPerTokenStored.value - this.accData(account).value.userRewardPerTokenPaid))
	//       +
	//       this.accData(account).value.rewards
	//     )
	int 24
	frame_dig -1 // account: address
	box_get
	assert
	extract 0 8
	btoi
	byte 0x726577617264506572546f6b656e53746f726564 // "rewardPerTokenStored"
	app_global_get
	frame_dig -1 // account: address
	box_get
	assert
	extract 8 8
	btoi
	-
	*
	frame_dig -1 // account: address
	box_get
	assert
	extract 16 8
	btoi
	+
	itob
	frame_dig -1 // account: address
	cover 2
	box_replace

	// contracts/stake.algo.ts:92
	// return this.accData(account).value.earned;
	frame_dig -1 // account: address
	box_get
	assert
	extract 24 8
	btoi
	itob
	byte 0x151f7c75
	swap
	concat
	log
	retsub

// updateReward(address)uint64
abi_route_updateReward:
	// account: address
	txna ApplicationArgs 1
	dup
	len
	int 32
	==
	assert

	// execute updateReward(address)uint64
	callsub updateReward
	int 1
	return

updateReward:
	proto 1 0

	// contracts/stake.algo.ts:96
	// this.rewardPerToken()
	callsub rewardPerToken

	// contracts/stake.algo.ts:97
	// this.updatedAt.value = this.lastTimeReward.value
	byte 0x757064617465644174 // "updatedAt"
	byte 0x6c61737454696d65526577617264 // "lastTimeReward"
	app_global_get
	app_global_put

	// contracts/stake.algo.ts:98
	// this.earned(account)
	frame_dig -1 // account: address
	callsub earned

	// contracts/stake.algo.ts:99
	// this.accData(account).value.rewards = this.accData(account).value.earned
	int 16
	frame_dig -1 // account: address
	box_get
	assert
	extract 24 8
	btoi
	itob
	frame_dig -1 // account: address
	cover 2
	box_replace

	// contracts/stake.algo.ts:100
	// this.accData(account).value.userRewardPerTokenPaid = this.rewardPerTokenStored.value
	int 8
	byte 0x726577617264506572546f6b656e53746f726564 // "rewardPerTokenStored"
	app_global_get
	itob
	frame_dig -1 // account: address
	cover 2
	box_replace

	// contracts/stake.algo.ts:101
	// return this.accData(account).value.rewards;
	frame_dig -1 // account: address
	box_get
	assert
	extract 16 8
	btoi
	itob
	byte 0x151f7c75
	swap
	concat
	log
	retsub

// appOptedinAsset(asset)void
abi_route_appOptedinAsset:
	// stakingToken: asset
	txna ApplicationArgs 1
	btoi
	txnas Assets

	// execute appOptedinAsset(asset)void
	callsub appOptedinAsset
	int 1
	return

appOptedinAsset:
	proto 1 0

	// contracts/stake.algo.ts:105
	// sendAssetTransfer({
	//       xferAsset: this.stakingToken.value,
	//       assetReceiver: this.app.address,
	//       assetAmount: 0,
	//     })
	itxn_begin
	int axfer
	itxn_field TypeEnum

	// contracts/stake.algo.ts:106
	// xferAsset: this.stakingToken.value
	byte 0x7374616b696e67546f6b656e // "stakingToken"
	app_global_get
	itxn_field XferAsset

	// contracts/stake.algo.ts:107
	// assetReceiver: this.app.address
	global CurrentApplicationAddress
	itxn_field AssetReceiver

	// contracts/stake.algo.ts:108
	// assetAmount: 0
	int 0
	itxn_field AssetAmount

	// Fee field not set, defaulting to 0
	int 0
	itxn_field Fee

	// Submit inner transaction
	itxn_submit
	retsub

// stake(asset,axfer)void
abi_route_stake:
	// stakingToken: asset
	txna ApplicationArgs 1
	btoi
	txnas Assets

	// axfer: axfer
	txn GroupIndex
	int 1
	-
	dup
	gtxns TypeEnum
	int axfer
	==
	assert

	// execute stake(asset,axfer)void
	callsub stake
	int 1
	return

stake:
	proto 2 0

	// Verify axfer
	// contracts/stake.algo.ts:114
	// verifyTxn(axfer, { assetReceiver: this.app.address })
	// verify assetReceiver
	frame_dig -1 // axfer: axfer
	gtxns AssetReceiver
	global CurrentApplicationAddress
	==
	assert

	// contracts/stake.algo.ts:115
	// this.accData(this.txn.sender).value.balance = this.accData(this.txn.sender).value.balance + axfer.assetAmount
	int 0
	txn Sender
	box_get
	assert
	extract 0 8
	btoi
	frame_dig -1 // axfer: axfer
	gtxns AssetAmount
	+
	itob
	txn Sender
	cover 2
	box_replace

	// contracts/stake.algo.ts:117
	// this.totalSupply.value = this.totalSupply.value + axfer.assetAmount
	byte 0x746f74616c537570706c79 // "totalSupply"
	byte 0x746f74616c537570706c79 // "totalSupply"
	app_global_get
	frame_dig -1 // axfer: axfer
	gtxns AssetAmount
	+
	app_global_put

	// contracts/stake.algo.ts:119
	// this.updateReward(this.txn.sender)
	txn Sender
	callsub updateReward
	retsub

// withdraw(asset,uint64)void
abi_route_withdraw:
	// stakingToken: asset
	txna ApplicationArgs 2
	btoi
	txnas Assets

	// amount: uint64
	txna ApplicationArgs 1
	btoi

	// execute withdraw(asset,uint64)void
	callsub withdraw
	int 1
	return

withdraw:
	proto 2 0

	// contracts/stake.algo.ts:123
	// assert(amount > 0)
	frame_dig -1 // amount: uint64
	int 0
	>
	assert

	// contracts/stake.algo.ts:124
	// assert(this.accData(this.txn.sender).value.balance >= amount)
	txn Sender
	box_get
	assert
	extract 0 8
	btoi
	frame_dig -1 // amount: uint64
	>=
	assert

	// contracts/stake.algo.ts:125
	// this.accData(this.txn.sender).value.balance = this.accData(this.txn.sender).value.balance - amount
	int 0
	txn Sender
	box_get
	assert
	extract 0 8
	btoi
	frame_dig -1 // amount: uint64
	-
	itob
	txn Sender
	cover 2
	box_replace

	// contracts/stake.algo.ts:126
	// this.totalSupply.value = this.totalSupply.value - amount
	byte 0x746f74616c537570706c79 // "totalSupply"
	byte 0x746f74616c537570706c79 // "totalSupply"
	app_global_get
	frame_dig -1 // amount: uint64
	-
	app_global_put

	// contracts/stake.algo.ts:127
	// sendAssetTransfer({
	//       xferAsset: this.stakingToken.value,
	//       assetReceiver: this.txn.sender,
	//       assetAmount: amount,
	//     })
	itxn_begin
	int axfer
	itxn_field TypeEnum

	// contracts/stake.algo.ts:128
	// xferAsset: this.stakingToken.value
	byte 0x7374616b696e67546f6b656e // "stakingToken"
	app_global_get
	itxn_field XferAsset

	// contracts/stake.algo.ts:129
	// assetReceiver: this.txn.sender
	txn Sender
	itxn_field AssetReceiver

	// contracts/stake.algo.ts:130
	// assetAmount: amount
	frame_dig -1 // amount: uint64
	itxn_field AssetAmount

	// Fee field not set, defaulting to 0
	int 0
	itxn_field Fee

	// Submit inner transaction
	itxn_submit

	// contracts/stake.algo.ts:132
	// this.updateReward(this.txn.sender)
	txn Sender
	callsub updateReward
	retsub

// getReward(asset)void
abi_route_getReward:
	byte 0x // push empty bytes to fill the stack frame for this subroutine's local variables

	// stakingToken: asset
	txna ApplicationArgs 1
	btoi
	txnas Assets

	// execute getReward(asset)void
	callsub getReward
	int 1
	return

getReward:
	proto 2 0

	// contracts/stake.algo.ts:136
	// reward = this.accData(this.txn.sender).value.rewards
	txn Sender
	box_get
	assert
	extract 16 8
	btoi
	frame_bury -2 // reward: uint64

	// if1_condition
	// contracts/stake.algo.ts:137
	// reward > 0
	frame_dig -2 // reward: uint64
	int 0
	>
	bz if1_end

	// if1_consequent
	// contracts/stake.algo.ts:139
	// sendAssetTransfer({
	//         xferAsset: this.stakingToken.value,
	//         assetReceiver: this.txn.sender,
	//         assetAmount: reward/1000,
	//       })
	itxn_begin
	int axfer
	itxn_field TypeEnum

	// contracts/stake.algo.ts:140
	// xferAsset: this.stakingToken.value
	byte 0x7374616b696e67546f6b656e // "stakingToken"
	app_global_get
	itxn_field XferAsset

	// contracts/stake.algo.ts:141
	// assetReceiver: this.txn.sender
	txn Sender
	itxn_field AssetReceiver

	// contracts/stake.algo.ts:142
	// assetAmount: reward/1000
	frame_dig -2 // reward: uint64
	int 1000
	/
	itxn_field AssetAmount

	// Fee field not set, defaulting to 0
	int 0
	itxn_field Fee

	// Submit inner transaction
	itxn_submit

	// contracts/stake.algo.ts:144
	// this.accData(this.txn.sender).value.rewards = 0
	txn Sender
	int 16
	byte 0x0000000000000000
	box_replace

if1_end:
	retsub

// setRewardsDuration(uint64)void
abi_route_setRewardsDuration:
	// duration: uint64
	txna ApplicationArgs 1
	btoi

	// execute setRewardsDuration(uint64)void
	callsub setRewardsDuration
	int 1
	return

setRewardsDuration:
	proto 1 0

	// contracts/stake.algo.ts:149
	// assert(this.txn.sender === this.app.creator)
	txn Sender
	txna Applications 0
	app_params_get AppCreator
	assert
	==
	assert

	// contracts/stake.algo.ts:150
	// assert(globals.latestTimestamp > this.finishAt.value)
	global LatestTimestamp
	byte 0x66696e6973684174 // "finishAt"
	app_global_get
	>
	assert

	// contracts/stake.algo.ts:151
	// this.duration.value = duration
	byte 0x6475726174696f6e // "duration"
	frame_dig -1 // duration: uint64
	app_global_put
	retsub

// addReward(uint64)void
abi_route_addReward:
	// amount: uint64
	txna ApplicationArgs 1
	btoi

	// execute addReward(uint64)void
	callsub addReward
	int 1
	return

addReward:
	proto 1 0

	// if2_condition
	// contracts/stake.algo.ts:156
	// globals.latestTimestamp >= this.finishAt.value
	global LatestTimestamp
	byte 0x66696e6973684174 // "finishAt"
	app_global_get
	>=
	bz if2_else

	// if2_consequent
	// contracts/stake.algo.ts:157
	// this.rewardRate.value = amount / this.duration.value
	byte 0x72657761726452617465 // "rewardRate"
	frame_dig -1 // amount: uint64
	byte 0x6475726174696f6e // "duration"
	app_global_get
	/
	app_global_put
	b if2_end

if2_else:
	// contracts/stake.algo.ts:159
	// this.rewardRate.value =
	//         (amount + this.rewardRate.value * (this.finishAt.value - globals.latestTimestamp)) / this.duration.value
	byte 0x72657761726452617465 // "rewardRate"
	frame_dig -1 // amount: uint64
	byte 0x72657761726452617465 // "rewardRate"
	app_global_get
	byte 0x66696e6973684174 // "finishAt"
	app_global_get
	global LatestTimestamp
	-
	*
	+
	byte 0x6475726174696f6e // "duration"
	app_global_get
	/
	app_global_put

if2_end:
	// contracts/stake.algo.ts:164
	// this.updatedAt.value = globals.latestTimestamp
	byte 0x757064617465644174 // "updatedAt"
	global LatestTimestamp
	app_global_put

	// contracts/stake.algo.ts:165
	// this.finishAt.value = globals.latestTimestamp + this.duration.value
	byte 0x66696e6973684174 // "finishAt"
	global LatestTimestamp
	byte 0x6475726174696f6e // "duration"
	app_global_get
	+
	app_global_put

	// contracts/stake.algo.ts:166
	// this.totalReward.value = amount
	byte 0x746f74616c526577617264 // "totalReward"
	frame_dig -1 // amount: uint64
	app_global_put
	retsub

// getBalanceData(account)uint64
abi_route_getBalanceData:
	// account: account
	txna ApplicationArgs 1
	btoi
	txnas Accounts

	// execute getBalanceData(account)uint64
	callsub getBalanceData
	int 1
	return

getBalanceData:
	proto 1 0

	// contracts/stake.algo.ts:170
	// return this.accData(account).value.balance;
	frame_dig -1 // account: account
	box_get
	assert
	extract 0 8
	btoi
	itob
	byte 0x151f7c75
	swap
	concat
	log
	retsub

// getUserRewardPerTokenPaid(account)uint64
abi_route_getUserRewardPerTokenPaid:
	// account: account
	txna ApplicationArgs 1
	btoi
	txnas Accounts

	// execute getUserRewardPerTokenPaid(account)uint64
	callsub getUserRewardPerTokenPaid
	int 1
	return

getUserRewardPerTokenPaid:
	proto 1 0

	// contracts/stake.algo.ts:174
	// return this.accData(account).value.userRewardPerTokenPaid;
	frame_dig -1 // account: account
	box_get
	assert
	extract 8 8
	btoi
	itob
	byte 0x151f7c75
	swap
	concat
	log
	retsub

// getTotalSupply()uint64
abi_route_getTotalSupply:
	// execute getTotalSupply()uint64
	callsub getTotalSupply
	int 1
	return

getTotalSupply:
	proto 0 0

	// contracts/stake.algo.ts:178
	// return this.totalSupply.value;
	byte 0x746f74616c537570706c79 // "totalSupply"
	app_global_get
	itob
	byte 0x151f7c75
	swap
	concat
	log
	retsub

create_NoOp:
	method "createApplication(uint64)address"
	txna ApplicationArgs 0
	match abi_route_createApplication
	err

call_NoOp:
	method "bootstrap()uint64"
	method "faucet(asset)void"
	method "getStakingToken()uint64"
	method "lastTimeRewardApplicable()uint64"
	method "rewardPerToken()uint64"
	method "earned(address)uint64"
	method "updateReward(address)uint64"
	method "appOptedinAsset(asset)void"
	method "stake(axfer,asset)void"
	method "withdraw(uint64,asset)void"
	method "getReward(asset)void"
	method "setRewardsDuration(uint64)void"
	method "addReward(uint64)void"
	method "getBalanceData(account)uint64"
	method "getUserRewardPerTokenPaid(account)uint64"
	method "getTotalSupply()uint64"
	txna ApplicationArgs 0
	match abi_route_bootstrap abi_route_faucet abi_route_getStakingToken abi_route_lastTimeRewardApplicable abi_route_rewardPerToken abi_route_earned abi_route_updateReward abi_route_appOptedinAsset abi_route_stake abi_route_withdraw abi_route_getReward abi_route_setRewardsDuration abi_route_addReward abi_route_getBalanceData abi_route_getUserRewardPerTokenPaid abi_route_getTotalSupply
	err